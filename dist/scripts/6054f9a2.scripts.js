"use strict";angular.module("demoElasticApp",["ngSanitize","ngRoute"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/wikipedia",{templateUrl:"views/wikipedia.html",controller:"WikipediaCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("demoElasticApp").controller("MainCtrl",["$scope","$http","$timeout",function(a,b){a.$watch("facets",function(b){b&&b.length>0&&c(a.query_string,b)}),a.$watch("query_string",function(a){c(a,[])});var c=function(c,d){var e=null;if(c){e={query:{bool:{should:[{match:{contenu:{query:c}}},{match:{conferenciers:{query:c}}},{match:{salle:{query:c}}},{match:{horaire:{query:c}}},{match:{file:{query:c}}}]}},facets:{salle:{terms:{field:"salle.original"}}},suggest:{suggest:{text:c,term:{field:"titre"}}},fields:["titre","contenu","conferenciers","salle","horaire"]},e.highlight={fields:{"file.file":{}}};var f=null;f=a.ngram?{match:{"titre.autocomplete_bidirectionnel":{query:c,boost:2,analyzer:"analyzer_tokenspace_asciifolding_lowercase"}}}:{match:{titre:{query:c,boost:2}}},e.query.bool.should.push(f)}else e={query:{bool:{must:[{match_all:{}}]}},facets:{salle:{terms:{field:"salle.original"}}},fields:["titre","contenu","conferenciers","salle","horaire"]};if(d.length>0){for(var g=[],h=0;h<d.length;h++)d[h].filter&&g.push({term:{"salle.original":d[h].name}});g.length>0&&(e.filter={or:g})}b.post("http://127.0.0.1:9200/forum/_search",e).success(function(b){if(a.results=b,console.debug(b),0==d.length&&(a.facets=new Array,a.results.facets))for(var c=0;c<a.results.facets.salle.terms.length;c++){var e=a.results.facets.salle.terms[c];a.facets.push({name:e.term,count:e.count,filter:!1})}})};a.use_suggest=function(b){a.query_string=b},a.facets=new Array,a.switch_facet_filter=function(b){a.facets[b].filter=!a.facets[b].filter,c(a.query_string,a.facets)}}]),angular.module("demoElasticApp").controller("WikipediaCtrl",["$scope","$http","$timeout","$q",function(a,b,c,d){var e=d.defer();a.$watch("facets",function(b){b&&b.length>0&&f(a.query_string,b)}),a.$watch("query_string",function(a){e.resolve(),e=d.defer(),f(a,[])});var f=function(c,d){var f=null;if(c){f={query:{bool:{should:[{match:{text:{query:c}}},{match:{link:{query:c}}}]}},suggest:{suggest:{text:c,term:{field:"link"}}}};var g=null;a.highlight&&(f.highlight={fields:{text:{}}}),g="ngram"==a.type?{match:{"title.autocomplete_bidirectionnel":{query:c,boost:2,analyzer:"analyzer_tokenspace_asciifolding_lowercase"}}}:"stemmer"==a.type?{match:{"title.stemmer":{query:c,boost:2}}}:{match:{title:{query:c,boost:2}}},f.query.bool.should.push(g)}else f={query:{bool:{must:[{match_all:{}}]}}};b({method:"POST",url:"http://127.0.0.1:9200/wikipedia/_search",data:f,timeout:e}).success(function(b){if(a.results=b,0==d.length&&(a.facets=new Array,a.results.facets))for(var c=0;c<a.results.facets.salle.terms.length;c++){var e=a.results.facets.salle.terms[c];a.facets.push({name:e.term,count:e.count,filter:!1})}}).error(function(){})};a.use_suggest=function(b){a.query_string=b},a.facets=new Array,a.switch_facet_filter=function(b){a.facets[b].filter=!a.facets[b].filter,f(a.query_string,a.facets)}}]);